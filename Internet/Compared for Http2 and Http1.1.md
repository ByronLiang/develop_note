# Http2与Http1.x相关对比总结

## Http2核心特性

默认使用加密传输协议`(Https)`

### 多路复用 multiplexing

Http1.x 使用管道式(pipeline)同步处理请求；每个请求按照顺序接收, 并返回原顺序请求的响应; 

Http2 采用多路复用，同一连接下，并行处理多个请求; 新增使用流方式(stream)传输数据

单连接多资源的方式，减少服务端的链接压力,内存占用更少,连接吞吐量更大；由于减少TCP 慢启动时间，提高传输的速度

### 编码特性

二进制格式编码(二进制协议), 不是文本协议; 传输数据无法可读

多个并行传输信息被分割成帧：二进制分帧，能有效识别与区分多路请求数据, 处理次序交错的通讯

### 头部数据压缩

在Http1.x, 请求和响应都是由`(状态行、请求 / 响应头部、消息主体)`三部分组成。一般而言，消息主体都会经过 gzip 压缩，或者本身传输的就是压缩过后的二进制文件（例如图片、音频），但状态行和头部却没有经过任何压缩，直接以纯文本传输

Http2 只需通过字符串表明header值: 通讯双方各自cache一份header fields表，既避免了重复header的传输，又减小了需要传输的大小

### 服务推送 server push

它允许服务端推送资源给浏览器，在浏览器明确地请求之前。一个服务器经常知道一个页面需要很多附加资源，在它响应浏览器第一个请求的时候，可以开始推送这些资源。这允许服务端去完全充分地利用一个可能空闲的网络，改善页面加载时间。 [应用不广, 静态资源一般有使用CDN, 提升不大]

## 补充

### Http SSL 加密细节

1. HTTPS是应用层协议; SSL/TLS加密, 属于七层网络里的表达层

2. 先完成TCP连接建立(三次握手)，再进行TLS/SSL握手过程(证书传送, 证书校验，获取密匙)后，才能建立通信安全的连接。

3. Http SSL 在证书验证阶段(服务端与客户端[浏览器])使用非对称加密

4. Http SSL 只需完成一次证书验证, 就能实行多次数据内容传输; 所以可以采用解密效率低的加密方法；

5. 数据内容是使用对称性加密；由于服务端与客户端需要进行多次数据传输, 需要采用较高效率的解密方法；并且密匙只在服务端,一对公私钥只能实现单向的加解密;

#### TLS/SSL流程

1. 向客户端传送证书，证书中包含了很多信息，如证书的颁发机构，过期时间，公钥; 

2. 客户端向CA证书机构验证证书是否有效，并生成一个随机值(用作对称加密的密匙)

3. 客户端使用证书的公匙对随机值进行加密，并发送给服务端

4. 服务端接收到加密数据，使用私匙进行解密，得出随机值(对称加密的密匙)

5. 客户端与服务端都得到了对称加密密匙，可以对传输数据进行加密与解密

#### 总结

证书的传递、校验，客户端私钥的生成、传递，用非对称加密传递秘钥，用对称加密传输数据

#### Https相关优化方向

1. 由于涉及加密与解密, Https里证书验证阶段，传输内容加密都属于`计算密集型` 不是I/O密集型[没涉及文件读写等], 选用更好的CPU [硬件优化]

2. 减少重复证书认证; 完成首次认证后，保留凭据: `会话重用` SessionId/SessionTicket
