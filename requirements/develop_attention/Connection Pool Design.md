# 连接池设计笔记

## 基本要素

1. 能进行复用连接, 确保连接状态良好;
2. 获取连接时具备线程安全;
3. 配置池的大小, 具备伸缩性; 超出可连接数量, 能处于连接等待排队状态;

### 线程安全方式

#### 缓冲channel

channel输入与输出具备线程安全性；设置缓冲数目，则为连接池里的数目

1. 当从channel取出连接时发生阻塞，则代表连接池已被取空；需要额外新建连接；

2. 当使用完连接重新放回时，若输入到channel发生阻塞，则线程池已满；需要将连接丢弃

## 协程池

### 设计思考

1. 抑制无限制生成go协程; 控制好系统内的协程数量; 涉及信号量(限制可同时运行的协程数量);

2. 避免协程的不断生成与回收;

3. 协程池与对象池(连接池等)区别: 不能放回去再取出来。

4. goroutine应该是一直运行着的。需要的时候就运行，不需要的时候就阻塞；对其他的goroutine的调度影响也不是很大。而goroutine的任务可以通过channel来传递；

### 易引发问题

1. 高并发时, 复用连接池里, 原请求数据与旧请求数据易引发错乱

