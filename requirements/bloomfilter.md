# 去重需求与布隆过滤方案

## 常见业务场景

对大数据量要求占用小内存空间，实现去重判断

### 常规做法

Redis: 存放有序集合。当超出数量, 优先将旧数据进行淘汰; 每次取出数据, 由列表转换为哈希, 保证去重判断里，复杂度为 O(1)

### 二进制存储

对于整型ID, 可采用二进制存储，将十进制转化成64位, 减小直接存储整型ID的空间, 同时能方便判断当前值是否存在

### 布隆过滤器存储

满足整型/字符串存储，可将数据存放在布隆过滤器, 哈希置位。但判断字符是否存在具有一定误差性

## 使用分析

- 布隆过滤器无法对写入的元素移除, 适合只写入的业务场景, 如浏览商品足迹, 消费队列的消息唯一ID等业务需求

### 消息队列幂等性与重复消费

每条消息设置唯一key, 当消费完成后, 将消息key 存进布隆过滤器里，每次读取与写入需要确保线程安全；设置一定时间长度，过期后将布隆过滤器数据回收处理

- 二进制存储而满足元素的写入与移除。写入与移除需要加锁，确保线程安全
