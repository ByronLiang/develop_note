# 排行榜业务与数据去重功能开发记录

## 榜单业务处理逻辑

### 总榜业务

1. 持久层无需进行where查询；需要确保order by 字段建立了索引

2. 榜单数据缓存：榜单数据有更新，则删除缓存；或仅对榜上的用户进行更新，未入榜的用户更新数据，无需删除缓存数据

### 周榜业务

1. 使用zset数据结构；低时间复杂度下实现新增成员、变动其中成员的数据、获取当前成员所在的排名、获取某个区间段的全部成员

2. 设置zset key的过期时间及配置对应归档和删除key的定时任务


## 数据去除业务功能实现

场景：文章阅读量，签到等实现去重数据统计

### 实现方法

1. 利用Redis的set数据结构，确保不重复统计；但会占用一定内存空间

2. 使用位图的一个位来表示一个用户id。如果一个用户id是32字节，那么使用位图就只需要占用 1/256 的空间就可以完成精确计数。当统计量较少的情况下，仍大量占用内存空间；

### 咆哮位图(Roaring bitmap)

有效减低内存空间；根据位图的使用，能动态扩容，变为普通位图

[roaring go实现]: https://github.com/RoaringBitmap/roaring
