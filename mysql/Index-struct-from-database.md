# The Index struct from MySQl and MongoDB

## B树 与 B+ 树的索引使用区别

### B+树

有序数组链表+平衡多路搜索树

- 只有叶子节点存放数据(Data域在叶子节点)，叶子节点之间具有链指针相连（有效提高数据遍历）；链表是采用双向链表
- 树内非子叶节点用来索引，不存储数据；
- 由于树节点作为索引（节点数目小），能减少磁盘IO次数下（查询效率高），快速找到目标索引
- 适合数据遍历操作；适合关系型数据库的索引

#### 叶子节点细节说明

1. 叶子节点为树中没有子节点的节点; `理解为树的最底部位置`;

2. 叶子节点里默认是一个Mysql的Page数据页(大小: 16kb)`[磁盘块]`; Page数据页之间是双向链表数据结构; 

3. 获取一定范围的数据，则从每个Page数据页之间取出数据；每个数据页都按照指定字段进行排序放置

### B树/B-树

B树和B-树都是指B-Tree `B-Tree` 是指平衡多路搜索树

有序数组+平衡多路搜索树

- 树内的每个节点都存储数据（每个节点都是Data域）；叶子节点之间无指针相邻
- 节点数目多，磁盘IO次数大；并且节点之间缺乏链指针相连，遍历数据效率低
- 适用于单一数据获取操作；适合非关系数据库的索引结构

### 数据库索引数据结构

- MySQL索引使用B+树; 数据都在叶节点上，每次查询都需要访问到叶节点; 着重满足数据遍历

- MongoDB索引使用B树;以BSON格式作为存储的非关系型数据库;只需匹配其索引，就能获取到数据(一次查询，获取所有数据)

- 哈希索引只针对单一数据查询高效；对于查询一定范围及多条数据不高效；

### 平衡二叉树不适合作为索引

#### 磁盘预读

一个数据被用到时，其附近的数据也通常会马上被使用。(每次都会预读，即使只需要一个字节，磁盘也会从这个位置开始，顺序向后读取一定长度的数据放入内存)

#### 平衡二叉树劣势

- 树深度大，无法利用数据之间的局部性; 需要进行磁盘I/O多；
- 不利于进行磁盘预读; 每次读取的磁盘页的数据中有许多是用不上的, 查找过程中要进行许多次的磁盘读取操作
- 不利于索引从磁盘拷贝到内存

### 聚簇索引/非聚簇索引 相关笔记

1. InnoDB中，表数据文件本身就是按B+Tree组织的一个索引结构，聚簇索引就是按照每张表的主键构造一颗B+树，同时叶子节点中存放的就是整张表的行记录数据，也将聚集索引的叶子节点称为数据页。这个特性决定了索引组织表中数据也是索引的一部分

2. 聚簇索引并不是一种单独的索引类型，而是一种数据存储方式。具体细节依赖于其实现方式。

3. MySQL数据库中innodb存储引擎，B+树索引可以分为聚簇索引（也称聚集索引，clustered index）和辅助索引（有时也称非聚簇索引或二级索引，secondary index，non-clustered index）。这两种索引内部都是B+树;

- 聚集索引: 叶子节点存放着一整行的数据(表中的数据)

- 非聚集索引：非主键创建的索引, 叶子节点中存储的是主键和索引列; 使用非聚集索引查询数据，会查询到叶子上的主键，再根据主键查到数据（这个过程叫做回表）

- 查询没有使用索引，需要遍历双向链表来定位对应的页；若查询使用索引，则使用二分查找；

4. Innobd中的主键索引是一种聚簇索引，非聚簇索引都是辅助索引，像复合索引、前缀索引、唯一索引。

5. Innodb使用的是聚簇索引，MyISam使用的是非聚簇索引

#### 聚簇索引与非聚簇索引的存储位置

对于InnoDB, 主键索引是聚簇索引；主键索引与辅助索引是两颗B+树，但其子叶节点的数据是不相同的，不指向相同的数据地址

对于MyISAM, 主键索引与辅助索引都是非聚簇索引: 同样是两颗B+树, 但同时指向相同的数据地址; 即时使用辅助索引查询数据，可以无需回表查询

#### 辅助索引查询原理, 覆盖索引与回表

InnoDB 辅助索引查找过程

在非聚簇索引的B+树寻找数据，所匹配的子叶数据里，包含主键与辅助索引的字段值; 若查询字段是此辅助索引的字段值，则直接返回数据；(覆盖索引)

若查询字段不在非聚簇索引的子叶点上，则需使用主键，在聚簇索引的B+树寻找数据，将匹配的子叶数据进行返回。(回表操作流程)

MyISAM: 直接在非聚簇索引的B+树寻找数据，返回匹配子叶域里的行数据
