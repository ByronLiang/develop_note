# MySQL优化查询

## 下推索引

索引条件下推优化可以减少存储引擎查询基础表的次数，也可以减少MySQL服务器从存储引擎接收数据的次数。

explain解析结果的Extra的值为`Using index condition`，表示已经使用了索引下推。

## 覆盖索引

所求查询字段（select列）和查询条件字段（where子句）全都包含在一个索引中，可以直接使用索引查询而不需要回表。

通过使用覆盖索引，可以减少搜索树的次数，是常用的性能优化手段


## filesort排序原理

1. 当排序字段未被设置索引时，会使用filesort来进行排序

filesort是通过相应的排序算法将取得的数据在内存中进行排序，每个线程都在独立的sort buffer内存进行排序。

sort_buffer_size参数设置内存的大小；内存大小影响所使用的排序算法

### 排序算法

1. 双路排序：首先根据相应的条件取出相应的排序字段和可以直接定位行数据的行指针信息，然后在sort buffer 中进行排序。
2. 单路排序：是一次性取出满足条件行的所有字段，然后在sort buffer中进行排序。

单路排序算法更加高效；有效减少I/O的使用

### 优化思路

1. 设置max_length_for_sort_data: 减少不必要字段返回并为满足使用单路排序算法

2. 设置sort_buffer_size: 减少在排序过程中对需要排序的数据进行分段；分段会造成使用临时表来进行交换排序。
