# 事务要素及隔离级别总结

## 事务的基本要素

### ACID

1. 原子性(Atomicity) 事务执行过程中出错, 会回滚到事务的开始状态
2. 一致性(Consistency) 事务开始前与结束后，数据库完整性没有被破坏
3. 隔离性(Isolation) 不同事务之间彼此没有任何干扰
4. 持久性 事务完成后，不能出现回滚

## 并发问题

1. 脏读：发生读取了已回滚数据；`事务A读取了事务B更新的数据，然后B回滚操作，那么A读取到的数据是脏数据`

2. 不可重复读: 事务过程中，不同时段重复读取数据出现不一致 `事务 A 多次读取同一数据，事务 B 在事务A多次读取的过程中，对数据作了更新并提交，导致事务A多次读取同一数据时，结果 不一致`

3. 幻读: 数据表出现新增/减少相关数据

总结：
- 不可重复读现象是数据修改问题，通过锁行进行处理；
- 幻读现象是数据的新增与删除；通过锁表可以避免出现；

## 事务隔离级别

### READ-UNCOMMITTED(读取未提交)

读取尚未事务提交的数据；容易引发脏读、幻读与不可重读

### READ-COMMITTED(读取已提交)

允许读取并发事务已经提交的数据，可以阻止脏读，但是幻读或不可重复读仍有可能发生

### REPEATABLE-READ(可重读)

对同一字段的多次读取结果都是一致的，除非数据是被本身事务自己所修改，可以阻止脏读和不可重复读，但幻读仍有可能发生。

### SERIALIZABLE(可串行化)

所有的事务依次逐个执行，这样事务之间就完全不可能产生干扰，也就是说，该级别可以防止脏读、不可重复读以及幻读。

#### 总结
- 隔离级别越低，事务请求的锁越少
- MySQL 默认使用的级别是REPEATABLE-READ（可重读）
- 查询: `SELECT @@tx_isolation`
- 设置: 
`SET [SESSION|GLOBAL] TRANSACTION ISOLATION LEVEL [READ UNCOMMITTED|READ COMMITTED|REPEATABLE READ|SERIALIZABLE]`
