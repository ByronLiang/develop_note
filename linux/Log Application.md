# 日志应用

## write ahead log 机制

一种实现事务日志的标准方法; 先写日志，再写数据，数据文件的修改必须发生在这些修改已经记录在日志文件中之后

### 优化wal机制性能

1. 多个client写日志文件可以通过一次 fsync()来完成

2. 日志文件是顺序写的，同步日志的开销要远比同步数据页的开销要小

## Redis AOF (append only file) 日志应用

先执行写命令，把数据写入内存中，再记录日志(`aof_buf`缓冲区, `fsync`: 把缓冲区日志内容写入磁盘中)

### 意义

1. 避免日志记录里出现记录错误命令

2. AOF 是在命令执行后才记录日志，所以不会阻塞当前的写操作

## 如何优化日志采集与数据持久化

1. 减少调用系统操作`write`与`fsync`的频率; 将写入数据存入缓冲区, 再批量进行磁盘持久化写入


