# 内存系统

## 操作系统的缺页中断

进程线性地址空间里的页面不必常驻内存，在执行一条指令时，如果发现他要访问的页没有在内存中（即存在位为0），那么停止该指令的执行，并产生一个页不存在的异常，对应的故障处理程序可通过从外存加载该页的方法来排除故障，之后，原先引起的异常的指令就可以继续执行，而不再产生异常。

### 处理流程

1. 检查要访问的虚拟地址是否合法

2. 查找/分配一个物理页

3. 填充物理页内容（读取磁盘，或者直接置0，或者什么都不做）

4. 建立映射关系（虚拟地址到物理地址的映射关系）

5. 重复执行发生缺页中断的那条指令

## 申请内存与内存操作

1. 先分配虚拟内存地址, 当进程访问时, 发送缺页中断, 内核才分配内存在对应的物理页(malloc函数) [分配内存小于128k]

2. 默认情况下，malloc函数分配内存，如果请求内存大于128K（可由M_MMAP_THRESHOLD选项调节），那就不是去推_edata指针了，而是利用mmap系统调用，从堆和栈的中间分配一块虚拟内存
