# Redis的有序集合分数数值分析

## 原理

1. score的数据结构是双浮点;64 位双精度浮点数只有 52 位有效数字，它能精确表达的整数范围为 - 2^53 到 2^53，最高只能表示 16 位十进制整数；当超出16位，会出现精度缺少问题

2. 底层结构里，member字段数据以字符串存储(SDS)

## 应用

1. 用户量不大的实时排名业务：

- members: 是参与者的user_id
- score: 分数与时间戳的总和；时间戳数值长度是10位；而分数数值长度不能超过6位

2. 结果集中某个成员的分数值是所有给定集下该成员分数值之和

`ZUNIONSTORE destination numkeys key [key ...]`

- Redis Zunionstore 命令计算给定的一个或多个有序集合的并集，其中给定 key 的数量必须以 numkeys 参数指定，并将该并集(结果集)储存到 destination

### 同一分数, 时间越早排名越前

1. 因同一分数下，按时间倒序排列；计算核心: `带时间戳的分数 = 实际分数*10000000000 + (9999999999 – timestamp)`
2. 提取分数：分离后10位的数值；提取时间戳：9999999999 - 后10位的数值；


### 同一分数, 时间越迟排名越前

1. 计算核心: `带时间戳的分数 = 实际分数*10000000000 + timestamp(10位十进制)`
2. 提取分数：分离后10位的数值；提取时间戳：后10位的数值；
