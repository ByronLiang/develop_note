# Redis 基本笔记

## 基本理论

- Redis实例对应多个db (默认16个) 每个db对应多个key,每个key对应一个value (数据结构：string[字符串]、list[列表]、map/hash[哈希]、set[集合]、sorted-set[有序集合])

- 通常以":"作为分隔符，将命名空间值和业务key连接

- list、Map、Set与sorted-set 的内存数据结构都具备ziplist[特殊编码的双向链表]特性

### pipeline模式提升吞吐量

Redis服务器采用TCP协议; 可将请求数据批量发送到服务器，再批量地从服务器连接的字节流中依次读取每个响应数据，提高单连接吞吐量；

### 入队/执行分离的事务原子性

- 客户端请求发送到服务器，暂存请求队列中；
- 服务器仅单线程地依次执行连接对象队列中的所有请求，期间不会执行其他客户端的请求
- 只读操作放在批量执行中没意义：结果不会改变事务的执行行为, 也不会改变Redis的数据状态；入队的请求应该是写操作；

#### 事务交互模式

- 四类请求
    1. 监听相关(watch、unwatch)
    2. 只读、写请求的批量执行或放弃执行请求(exec/discard)
    3. 写请求的入队(multi/exec/discard)

- 交互时序
    1. 开启对读写主键的监听、只读操作；
    2. multi请求
    3. 只读操作结果编排/参数赋值/入队写操作
    4. 一次性批量执行队列中的写请求

- 一旦两次读操作获取的值不一致, watch机制触发，拒绝后续的exec执行；
- Redis的执行器是单线程，写操作的执行本身就是通过串行的方式实现的可串行化；
