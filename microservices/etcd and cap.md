# etcd分布式kv raft算法 CAP理论分析

## CAP理论

## etcd

etcd是满足CP的分布式应用; CP是指`(C)`一致性; `(P)`分区容错性; 放弃可用性`(A)`

### CAP理论分析

raft是强leader型算法，客户端使用etcd服务只能通过leader进行；AB分区后，不存在leader，所以无法对外提供服务，之前连接AB节点的客户端将无法获取服务；体现无法满足可用性;

客户端无法感知leader发生变换，它将请求交给AB时，因为AB知道自己不是leader，但同时也不知道leader是谁，所以会向客户端响应轮询节点更换，找到新的leader。

因为分区后AB服务对外提供读写服务，之前连接AB的客户端会受此影响，所以会增加请求读时间，这里就体现了raft协议满足了CAP中的CP，而没有满足A

#### 分布式系统与CAP特点

对于P，在分布式环境下P一定存在，这时再考虑CA;在单机下，P不会存在，CA则必定存在。

P存在，要求C，则在网络分区后，要求数据一致，就需要放弃一部分服务的可用性。
P存在，要求A，则在网络分区后，要求所以节点仍能提供服务，这必定会带来分区间的数据不一致。
P不存在，就是单机环境了，单机下CA是一定存在

#### 理论应用

1. CP理论: 分布式数据库(redis/zk/etcd)
2. AP理论: 商城(库存数量) 确保功能可用, 数据一致性暂无法及时满足
3. CA理论: 只满足单机需求，无法实现服务扩展
