# Redis 与 Etcd 基于服务发现与注册的相关笔记

主要从分布式k/v，服务发现与注册角度，对比Redis 与 Etcd

## Redis不适合实现服务发现与注册的要旨

1. redis 没有版本的概念，历史版本数据在大规模微服务中非常有必要，无法进行状态回滚和故障排查

2. 对于服务注册与发现，只能依赖 pub 和 sub 实现；但无法保证低延迟，与数据通知无法保证都能被接收（不会保留历史信息）


### 无法遵循分布式的基本原则(CAP)

#### 无法保证强一致性

1. redis 的持久化方案有 aof 和 rdb，这两种方案在宕机的时候都或多或少的会丢失数据

2. 主从异步复制机制，仍有丢失数据风险：异步复制的机制在从升主的过程中或者网络分区的情况下都是有可能丢失数据的

#### 容错性

1. 网络分区（脑裂情景）引发不同网络段数据不一致情况；

## ETCD 更适合作为分布式服务发现与注册的要旨

### 高可用 与 一致性方面

1. etcd 基于 raft 协议在写入数据的时候需要多数应答确认后才会向客户端返回数据写入成功这就保证了数据的一致性

2. 一主多从，只能写主，底层采用 boltdb 作为 k/v 存储，直接落盘
