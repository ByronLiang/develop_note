# RPC请求的超时与重试次数

## 设置超时解决的问题

提高服务链路稳定性，具备容错能力

### 设置重试与超时关注的问题

1. 重复请求: 需确保接口幂等性，防止脏数据产生
2. 降低服务的负载能力，重试引发集群异常

## 相关设置思考

1. 多粒度的超时设置: 全局超时时间应该要略大于接口级别最长的耗时时间，每个接口的超时时间应该要略大于方法级别最长的耗时时间，每个方法的超时时间应该要略大于实际的方法执行时间

2. 评估可重试服务与不可重试服务; 读接口是天然幂等的，写接口则可以使用业务单据ID或者在调用方生成唯一ID传递给服务端，通过此ID进行防重避免引入脏数据

3. 评估服务业务场景: 内部应用服务，不设置重试，以人工重试；高QPS的对外服务，考虑使用超时的降级与熔断机制；设置合理重试次数

### 请求结果幂一致性

需要考虑rpc接口里，业务执行成功，但出现rpc超时情况；

#### 业务场景

使用积分抽奖，rpc接口返回超时，但实际上积分已成功消费了；若发起重试，则出现重复消费积分情况；

解决: 无论首次调用接口，还是超时重试调用接口，新增积分消费ID来调用rpc接口，对积分消费ID进行判断，若存在相关记录，则证明已完成积分消费，不进行积分的业务逻辑；
