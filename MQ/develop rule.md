# 消息队列设计/开发规范

- 根据业务特点来划分出不同的队列，不能将所有的任务都让同一队列消费。

将队列划分为low, middle, high这几种队列，对于耗时长/非紧急的任务可以扔去low的队列中，而对于时效性高，重要的任务就扔去high队列中，确保尽可能快的被执行到

- 并发数设置

对于非强制的消费顺序, 可配置多进程数来消费消息；最优配置: 进程数与CPU核心数一致

进程数配置影响: 少了不能很好的利用多核，多了性能下降估计是因为开多的进程带来的性能的提升小于因上下文切换带来的性能损失

- 对失败进行重试处理

1. 设定最大重试次数(max_retries)，避免无限重试
2. 重试的延时最好是更具重试次数进行增量延时，给更多的时间让等待服务恢复正常，以提高成功率
3. 预估一下任务的正常处理时间，根据这个时间来规定一个任务的最大执行时间。
