# HashMap Detail

## 基本

- HashMap是`数组 + 链表`组成，插入慢、查询快的数据结构。
- Hashtable 初始容量是11 ，扩容 方式为2N+1; HashMap 初始容量是16,扩容方式为2N;

### 容量、空间 与 设定加载因子0.75

HashMap有两个参数影响其性能：初始容量和加载因子。容量是哈希表中桶的数量，初始容量只是哈希表在创建时的容量。加载因子是哈希表在其容量自动扩容之前可以达到多满的一种度量。当哈希表中的条目数超出了加载因子与当前容量的乘积时，则要对该哈希表进行扩容、rehash操作（即重建内部数据结构），扩容后的哈希表将具有两倍的原容量。

- 加载因子过高，例如为1，虽然减少了空间开销，提高了空间利用率，但同时也增加了查询时间成本；

- 加载因子过低，例如0.5，虽然可以减少查询时间成本，但是空间利用率很低，同时提高了rehash操作的次数。

在设置初始容量时应该考虑到映射中所需的条目数及其加载因子，以便最大限度地减少rehash操作次数，所以，一般在使用HashMap时建议根据预估值设置初始容量，减少扩容操作。

选择0.75作为默认的加载因子，完全是时间和空间成本上寻求的一种折衷选择

## 应用

### Redis哈希类型

- 利用`链地址法`解决哈希冲突; 冲突位置的元素构造成链表

#### 处理冲突优缺点

- 优点:

1. 拉链法处理冲突简单，且无堆积现象，即非同义词决不会发生冲突，因此平均查找长度较短；
2. 由于拉链法中各链表上的结点空间是动态申请的，故它更适合于造表前无法确定表长的情况；
3. 在用拉链法构造的散列表中，删除结点的操作易于实现。只要简单地删去链表上相应的结点即可。

- 缺点：

1. 指针需要额外的空间，故当结点规模较小时，开放定址法较为节省空间，而若将节省的指针空间用来扩大散列表的规模，可使装填因子变小，这又减少了开放定址法中的冲突，从而提高平均查找速度

### Nginx存储location配置

- 采用`开放定址法`解决冲突; 以当前冲突位置为起点，步长为１循环查找，直到找到一个空的位置就把元素插进去

#### 处理优缺点

- 优点

1. 节省空间; 无需存储到外部链表里;

- 缺点

1. 这种方法建立起来的hash表当冲突多的时候数据容易堆聚在一起，这时候对查找不友好；
2. 删除结点不能简单地将被删结 点的空间置为空，否则将截断在它之后填人散列表的同义词结点的查找路径。因此在 用开放地址法处理冲突的散列表上执行删除操作，只能在被删结点上做删除标记，而不能真正删除结点
3. 当空间满了，还要建立一个溢出表来存多出来的元素。

## Tries 前缀树

常见节点结构体
```go
package main

type Trie struct {
    next map[rune]*Trie
}
```

### 特点

1. 由数组与指针组成；对比`Hash Table` 无需对key进行哈希处理，也无需处理哈希冲突; 在初始状态下，会比较占用内存

2. 前缀树的插入与查找涉及DFS（深度搜索）算法

3. 当前缀树达到一定规模，因初始化的节点达到一定数量，新插入值将会减少节点新增数量

4. 处理的字符串越长, 会相对耗时间与内存
