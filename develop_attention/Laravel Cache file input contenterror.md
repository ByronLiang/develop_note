# 缓存目录文件夹权限与权限组引发缓存写入错误

## 错误

使用缓存驱动是file：进行`\Cache::put()` 写操作诱发file_put_contents () 错误，failed to open stream: No such file or directory

## 分析

- 当使用`sudo php artisan tinker` 打开控制台, 并操作`\Cache::flush()` 会执行清空缓存，并且同时将缓存文件夹的权限及权限组变更为`root`用户

- 当应用的用户组(如: www-data)进行对原缓存key进行新的写入缓存操作，会因权限不足，导致无法写入文件`file_put_content` 诱发报错出现；

## 处理

- 尽量在应用(以用户组及其权限)编写相关脚本逻辑来处理回应用的业务; 

- 避免使用root账号去执行命令, 以浏览器的访问时的账号(www-data)进行相关操作;

- 找出发生权限组变更的文件夹, 修正其文件夹的权限；`chown -R www-data:www-data xxx文件名` [改变某个文件或目录的所有者和用户组]

### 修改文件权限, 所属用户和组详解

- Linux用户分为: 拥有者、组群、其他；用户记录存储在`/etc/passwd` 组群名称记录`/etc/group`

#### 文件权限分析：

如`-rw-r--r--` 第一个`-` 表示属普通文件；之后每三个长度的字符代表对应用户的权限；

1. 第一组`rw-` 代表所属拥有者的用户身份拥有对文件的操作权限；
2. 第二组`r--` 代表所属组群的用户身份拥有对文件的操作权限；
3. 第三组`r--` 代表其他身份的用户对文件的操作权限;

#### 权限属性分析

- r=读取属性    `值=4`
- w=写入属性    `值=2`
- x=执行属性    `值=1`

当使用命令`chmod -R 777 xxx文件名` 

- 表明对此文件夹的拥有者、所属组群与其他用户都配置`读写执行[4+2+1=7]`的权限;
- `-R` 递归处理，对指定目录下的所有文件及其子目录一并处理其权限修改;


#### 修改所有者和用户组

- chown -R `用户拥有者`:`用户组` 文件名称   [同时改变文件夹的用户拥有者和用户组]

- chown -R `用户拥有者` 文件名称 [单独变更文件夹的用户拥有者]

#### 单独修改所属用户组

- chgrp -R `用户组` 文件名称 [单独变更文件夹的用户组]

## 总结

- `chmod`命令只变更文件权限，不变更其使用对象，变更使用对象的权限

- `chown` / `chgrp` 命令变更文件的使用对象；不变更其对象的使用权限

