# Redis分布式锁续期 及 重入锁设计

## 优化重复下单业务设计

当调用下单接口, 以用户ID为key，生成一个分布式锁, 并设立短暂过期时间, 避免出现瞬时重复下单的情况出现;

## 分布式锁续期

因不可预估的情景发生, 业务未完成, 分布式锁已过期;

### 解析

1. 在获取锁的时候, 建立一个定时线程, 在过期时间前的一个时间点里进行续期处理; 

2. 当进行解锁处理时, 结束定时线程, 再完成释放锁操作;

## 分布式可重入锁

锁key里的value存储锁的次数; 每次解锁, 进行原子操作减少value的值

```go

redisLocker.Lock()
// DO
// 重入锁
redisLocker.Lock()
// DO

// 解锁
redisLocker.UnLock()
// DO
redisLocker.UnLock()
```
